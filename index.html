<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>La Hermandad: El juego</title>
<style>
  body {
    background: black;
    color: white;
    font-family: monospace, monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    height: 100vh;
    justify-content: center;
  }
  #game {
    white-space: pre;
    font-size: 20px;
    line-height: 1.2;
    text-align: center;
    user-select: none;
  }
  #dialogue {
    margin: 10px 0;
    min-height: 40px;
  }
  #status {
    margin: 10px 0;
  }
  #controls {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  button {
    background: #222;
    border: 1px solid white;
    color: white;
    padding: 8px 12px;
    font-size: 18px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  button:disabled {
    opacity: 0.4;
    cursor: default;
  }
  #combat-options {
    display: none;
    gap: 10px;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<h1>La Hermandad: El juego</h1>

<div id="game"></div>

<div id="dialogue"></div>
<div id="status"></div>

<div id="combat-options">
  <button id="attack-btn">Espada</button>
  <button id="defend-btn">Escudo</button>
</div>

<div id="controls">
  <button id="up-btn">↑</button>
  <button id="left-btn">←</button>
  <button id="down-btn">↓</button>
  <button id="right-btn">→</button>
  <button id="reset-btn">Reiniciar</button>
</div>

<script>
(() => {
  const gameEl = document.getElementById("game");
  const dialogueEl = document.getElementById("dialogue");
  const statusEl = document.getElementById("status");
  const combatOptionsEl = document.getElementById("combat-options");
  const attackBtn = document.getElementById("attack-btn");
  const defendBtn = document.getElementById("defend-btn");

  // Mapa sala principal, tamaño 9x7, rodeado de #
  const sala1 = [
    "#########",
    "#       #",
    "#   z   #",
    "#       #",
    "#   o   #",
    "#       #",
    "#########"
  ];

  // Mapa sala 2 (accesible por puerta arriba en sala1)
  const sala2 = [
    "#########",
    "#       #",
    "#   R   #",
    "#       #",
    "#       #",
    "#       #",
    "#########"
  ];

  let currentMap = sala1.map(row => row.split(""));
  let currentRoom = 1;

  // Posición jugador
  let playerX = 4;
  let playerY = 4;

  // NPC diálogos
  const zaidDialogues = ["Zaid: Mano"];
  let zaidDialogueIndex = 0;

  // Roibert diálogos
  const roibertDialogues = [
    "tu acaso eres como es que se llama shisui?",
    "no me acuerdo cómo es ese mamaguevo de Naruto",
    "que tiene como 30 cara no hagas eso mano",
    "eso no va bien habla claro y ya wn",
    "no puedes hace es...",
    "y de paso teniendo jeva mano",
    "o sea tú tú tienes la cara de piedra mano",
    "tu eres un totem una mierda así",
    "un busto no mano",
    "mamaguevo"
  ];
  let roibertDialogueIndex = 0;

  // Estado combate
  let inCombat = false;

  // Vida jugador y enemigo
  const playerMaxHp = 50;
  let playerHp = playerMaxHp;
  const roibertMaxHp = 75;
  let roibertHp = roibertMaxHp;

  // Defensa escudo
  let playerDefending = false;
  let playerHasShieldNextTurn = 0;

  // Renderizar mapa en el div
  function renderMap() {
    const mapCopy = currentMap.map(row => [...row]);
    mapCopy[playerY][playerX] = "o";
    let text = "";
    for (let row of mapCopy) {
      text += row.join("") + "\n";
    }
    gameEl.textContent = text;
  }

  // Mostrar diálogo
  function showDialogue(text) {
    dialogueEl.textContent = text;
  }

  // Mostrar estado vidas
  function showStatus() {
    statusEl.textContent = `Vida: ${playerHp}/${playerMaxHp}` + (inCombat ? ` | Roibert: ${roibertHp}/${roibertMaxHp}` : "");
  }

  // Reiniciar juego
  function resetGame() {
    inCombat = false;
    currentRoom = 1;
    playerHp = playerMaxHp;
    roibertHp = roibertMaxHp;
    playerDefending = false;
    playerHasShieldNextTurn = 0;
    zaidDialogueIndex = 0;
    roibertDialogueIndex = 0;
    currentMap = sala1.map(row => row.split(""));
    playerX = 4;
    playerY = 4;
    combatOptionsEl.style.display = "none";
    showDialogue("Bienvenido a La Hermandad: El juego. Habla con Zaid (z) y muévete con las flechas.");
    showStatus();
    renderMap();
  }

  // Mover jugador
  function movePlayer(dx, dy) {
    if (inCombat) return; // No se puede mover en combate

    const newX = playerX + dx;
    const newY = playerY + dy;

    if (newY < 0 || newY >= currentMap.length || newX < 0 || newX >= currentMap[0].length) return;

    const targetCell = currentMap[newY][newX];

    if (targetCell === "#") return; // Pared

    // Verificar puerta arriba sala 1
    if (currentRoom === 1 && newY === 0 && targetCell === " ") {
      // Cambiar a sala 2
      currentRoom = 2;
      currentMap = sala2.map(row => row.split(""));
      playerX = 4;
      playerY = 6; // Aparece abajo
      showDialogue("Entraste a la nueva sala.");
      renderMap();
      showStatus();
      return;
    }

    // Volver sala1 si en sala2 va abajo en puerta
    if (currentRoom === 2 && newY === currentMap.length - 1 && targetCell === " ") {
      currentRoom = 1;
      currentMap = sala1.map(row => row.split(""));
      playerX = 4;
      playerY = 1; // Aparece arriba
      showDialogue("Regresaste a la sala principal.");
      renderMap();
      showStatus();
      return;
    }

    // Mover
    playerX = newX;
    playerY = newY;
    renderMap();

    // Interacciones
    if (currentRoom === 1 && targetCell === "z") {
      // Hablar con Zaid
      showDialogue(zaidDialogues[zaidDialogueIndex]);
      zaidDialogueIndex = (zaidDialogueIndex + 1) % zaidDialogues.length;
    } else if (currentRoom === 2 && targetCell === "R") {
      // Hablar con Roibert
      if (roibertDialogueIndex < roibertDialogues.length) {
        showDialogue(roibertDialogues[roibertDialogueIndex]);
        roibertDialogueIndex++;
      } else {
        showDialogue("¡Comienza el combate!");
        startCombat();
      }
    } else {
      showDialogue("");
    }
  }

  // Inicio combate
  function startCombat() {
    inCombat = true;
    playerHp = playerMaxHp;
    roibertHp = roibertMaxHp;
    playerDefending = false;
    playerHasShieldNextTurn = 0;
    showStatus();
    dialogueEl.textContent = "¡Comienza el combate! Elige: Espada o Escudo.";
    combatOptionsEl.style.display = "flex";
  }

  // Mostrar estado en combate
  function showStatus() {
    if(inCombat) {
      statusEl.textContent = `Vida jugador: ${playerHp}/${playerMaxHp} | Vida Roibert: ${roibertHp}/${roibertMaxHp}`;
    } else {
      statusEl.textContent = `Vida jugador: ${playerHp}/${playerMaxHp}`;
    }
  }

  // Ataque jugador
  function playerAttack() {
    if(!inCombat) return;

    combatOptionsEl.style.display = "none";

    const damage = Math.floor(Math.random() * 6) + 5; // 5-10 daño

    roibertHp -= damage;
    if (roibertHp < 0) roibertHp = 0;

    showDialogue(`Atacaste con espada y causaste ${damage} de daño.`);
    showStatus();

    playerDefending = false;

    setTimeout(() => {
      if (roibertHp <= 0) {
        endCombat(true);
      } else {
        roibertTurn();
      }
    }, 1500);
  }

  // Defensa jugador
  function playerDefend() {
    if(!inCombat) return;

    combatOptionsEl.style.display = "none";

    playerHas
